<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Commander Jivesh: Nebula Strike</title>
    <style>
        body {
            margin: 0;
            background: #000;
            overflow: hidden;
            touch-action: none;
            /* Prevents mobile scrolling while playing */
            font-family: 'Segoe UI', sans-serif;
            -webkit-user-select: none;
            /* Mobile UI polish */
            user-select: none;
        }

        canvas {
            display: block;
            cursor: none;
        }

        #boot-up {
            position: fixed;
            inset: 0;
            background: radial-gradient(circle, #001f3f, #000);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #0ff;
            z-index: 100;
            text-align: center;
            padding: 20px;
        }

        .start-btn {
            background: #0ff;
            color: #000;
            padding: clamp(15px, 5vw, 25px) clamp(40px, 10vw, 80px);
            border-radius: 15px;
            font-size: clamp(20px, 6vw, 28px);
            font-weight: 900;
            cursor: pointer;
            border: 4px solid #fff;
            box-shadow: 0 0 50px #0ff;
            transition: 0.3s;
            text-transform: uppercase;
        }

        #hud {
            position: absolute;
            top: env(safe-area-inset-top, 20px);
            width: 100%;
            display: flex;
            justify-content: space-around;
            color: #0ff;
            font-size: clamp(16px, 4vw, 24px);
            font-weight: bold;
            pointer-events: none;
            z-index: 10;
            text-shadow: 0 0 10px #0ff;
        }
    </style>
</head>

<body>

    <div id="hud">
        <div>HERO: JIVESH</div>
        <div>ENERGY: <span id="xp">0</span></div>
    </div>

    <div id="boot-up" onclick="powerOn()">
        <h1 style="font-size: clamp(3rem, 15vw, 5rem); margin: 0; letter-spacing: 10px;">JIVESH</h1>
        <p style="color: #fff; margin-bottom: 40px; letter-spacing: 3px; font-size: 1rem;">SUPERHERO DATA-QUEST</p>
        <button class="start-btn">BOOT SYSTEM</button>
    </div>

    <canvas id="game"></canvas>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d', { alpha: false });
        const xpEl = document.getElementById('xp');
        const bootScreen = document.getElementById('boot-up');

        let active = false, score = 0, items = [], particles = [];
        let pX = 0, pTargetX = 0;
        let audioCtx, masterGain;

        // --- MOBILE OPTIMIZED AUDIO ---
        function startMusic() {
            if (!audioCtx) return;
            const melody = [261.63, 329.63, 392.00, 523.25, 440.00, 349.23];
            let noteIndex = 0;

            setInterval(() => {
                if (!active) return;
                const osc = audioCtx.createOscillator();
                const noteGain = audioCtx.createGain();

                osc.type = 'sine';
                osc.frequency.setValueAtTime(melody[noteIndex], audioCtx.currentTime);

                noteGain.gain.setValueAtTime(0.04, audioCtx.currentTime);
                noteGain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.8);

                osc.connect(noteGain);
                noteGain.connect(masterGain);

                osc.start();
                osc.stop(audioCtx.currentTime + 0.8);

                noteIndex = (noteIndex + 1) % melody.length;
            }, 300);
        }

        function playSfx(freq, type) {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.type = type || 'sine';
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            g.gain.setValueAtTime(0.1, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.4);
            osc.connect(g);
            g.connect(masterGain);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.4);
        }

        function powerOn() {
            // Audio context must start on a user gesture (mobile rule)
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            masterGain = audioCtx.createGain();
            masterGain.gain.value = 0.3;
            masterGain.connect(audioCtx.destination);

            if (audioCtx.state === 'suspended') audioCtx.resume();

            bootScreen.style.display = 'none';
            score = 0; items = []; active = true;
            resize();
            pX = canvas.width / 2;
            pTargetX = pX;

            startMusic();
            requestAnimationFrame(engine);
        }

        // --- TOUCH & MOUSE UNIFICATION ---
        const getX = (e) => {
            if (e.touches && e.touches.length > 0) return e.touches[0].clientX;
            return e.clientX;
        };

        window.addEventListener('mousemove', (e) => { pTargetX = getX(e); }, { passive: true });
        window.addEventListener('touchmove', (e) => {
            e.preventDefault(); // Stops mobile screen from wobbling
            pTargetX = getX(e);
        }, { passive: false });

        function drawJivesh(x, y, tilt) {
            ctx.save();
            ctx.translate(x | 0, (y + Math.sin(Date.now() / 200) * 8) | 0);
            ctx.rotate(tilt);

            // 1. DYNAMIC CAPE
            ctx.fillStyle = '#d40000';
            ctx.beginPath();
            ctx.moveTo(-15, 0);
            ctx.quadraticCurveTo(-50 - Math.abs(tilt * 40), 30, -5, 60);
            ctx.lineTo(20, 40);
            ctx.fill();

            // 2. HERO BODY
            const bodyGrad = ctx.createLinearGradient(0, 0, 0, 60);
            bodyGrad.addColorStop(0, '#0044ff');
            bodyGrad.addColorStop(1, '#001133');
            ctx.fillStyle = bodyGrad;
            ctx.beginPath();
            ctx.roundRect(-25, 0, 50, 60, 12);
            ctx.fill();

            // 3. JIVESH NAME ON T-SHIRT
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('JIVESH', 0, 35);
            ctx.strokeStyle = '#0ff';
            ctx.strokeRect(-20, 22, 40, 18);

            // 4. THE HELMET
            ctx.fillStyle = '#f0f0f0';
            ctx.beginPath(); ctx.arc(0, -25, 25, 0, 7); ctx.fill();
            ctx.fillStyle = '#ffcc00';
            ctx.roundRect(-18, -35, 36, 18, 5); ctx.fill();

            // 5. JETPACK FLAMES
            ctx.fillStyle = '#0ff';
            ctx.fillRect(-18, 60, 8, 15 + Math.random() * 10);
            ctx.fillRect(10, 60, 8, 15 + Math.random() * 10);

            ctx.restore();
        }

        function engine() {
            if (!active) return;

            // BACKGROUND
            ctx.fillStyle = '#00040a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // STARS
            ctx.fillStyle = '#fff';
            for (let i = 0; i < 15; i++) {
                ctx.fillRect((i * 137) % canvas.width, (Date.now() * 0.1 + i * 250) % canvas.height, 2, 2);
            }

            // SMOOTH PHYSICS (LERP)
            let dx = pTargetX - pX;
            pX += dx * 0.2;
            let tilt = dx * 0.006;

            drawJivesh(pX, canvas.height - 120, tilt);

            // ITEM SPAWNING
            if (Math.random() < 0.04) {
                items.push({ x: Math.random() * canvas.width, y: -50, t: Math.random() > 0.3 ? 'ðŸ•' : 'ðŸ¥¦', s: 4 + (score / 120) });
            }

            for (let i = items.length - 1; i >= 0; i--) {
                let it = items[i];
                it.y += it.s;
                ctx.font = '45px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(it.t, it.x, it.y);

                // Collision
                if (Math.hypot(it.x - pX, it.y - (canvas.height - 120)) < 65) {
                    if (it.t === 'ðŸ•') {
                        score += 10;
                        xpEl.innerText = score;
                        playSfx(600);
                        items.splice(i, 1);
                        for (let j = 0; j < 6; j++) particles.push({ x: it.x, y: it.y, vx: Math.random() * 8 - 4, vy: Math.random() * 8 - 4, l: 1 });
                    } else {
                        active = false;
                        playSfx(100, 'square');
                        bootScreen.style.display = 'flex';
                        bootScreen.querySelector('h1').innerText = "TRY AGAIN";
                        bootScreen.querySelector('p').innerText = "Jivesh, Broccoli hit the suit! Score: " + score;
                    }
                } else if (it.y > canvas.height + 50) {
                    items.splice(i, 1);
                }
            }

            // PARTICLES
            for (let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i];
                p.x += p.vx; p.y += p.vy; p.l -= 0.03;
                ctx.fillStyle = `rgba(0, 255, 255, ${p.l})`;
                ctx.fillRect(p.x | 0, p.y | 0, 4, 4);
                if (p.l <= 0) particles.splice(i, 1);
            }

            requestAnimationFrame(engine);
        }

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            pX = canvas.width / 2;
        }

        window.addEventListener('resize', resize);
        resize();
    </script>
</body>

</html>